<!DOCTYPE html>
<html>
<head>
  <title>Dynamic Market & Station Selector</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    select { width: 100%; padding: 8px; margin-bottom: 20px; }
    .section { margin-bottom: 30px; }
  </style>
</head>
<body>

  <h2>Radio Deal Dynamic Selector</h2>

  <!-- Parent Market -->
  <div class="section">
    <label><strong>Parent Market</strong></label>
    <select id="parentSelect">
      <option value="">Select Parent...</option>
    </select>
  </div>

  <!-- Market Dropdown Multi Select -->
  <div class="section">
    <label><strong>Markets (Multi-Select)</strong></label>
    <select id="marketSelect" multiple size="6"></select>
  </div>

  <!-- Station Dropdown Multi Select -->
  <div class="section">
    <label><strong>Stations (Multi-Select)</strong></label>
    <select id="stationSelect" multiple size="10"></select>
  </div>

  <script>
    const dataUrl = "https://raw.githubusercontent.com/FuturiFinance/deal-calc/refs/heads/main/radio_data.json";

    let radioData = {};

    async function loadRadioData() {
      const res = await fetch(dataUrl);
      radioData = await res.json();
      populateParentDropdown();
    }

    function populateParentDropdown() {
      const parents = Object.keys(radioData);
      const parentSelect = document.getElementById("parentSelect");

      parents.forEach(parent => {
        const opt = document.createElement("option");
        opt.value = parent;
        opt.textContent = parent;
        parentSelect.appendChild(opt);
      });
    }

    document.getElementById("parentSelect").addEventListener("change", function () {
      const parent = this.value;
      const marketSelect = document.getElementById("marketSelect");
      const stationSelect = document.getElementById("stationSelect");

      marketSelect.innerHTML = "";
      stationSelect.innerHTML = "";

      if (!parent) return;

      const markets = Object.keys(radioData[parent]);

      markets.forEach(mkt => {
        const opt = document.createElement("option");
        opt.value = mkt;
        opt.textContent = mkt;
        marketSelect.appendChild(opt);
      });
    });

    document.getElementById("marketSelect").addEventListener("change", function () {
      const parent = document.getElementById("parentSelect").value;
      const selectedMarkets = Array.from(this.selectedOptions).map(o => o.value);

      const stationSelect = document.getElementById("stationSelect");
      stationSelect.innerHTML = "";

      selectedMarkets.forEach(market => {
        const stations = radioData[parent][market] || [];

        stations.forEach(st => {
          const opt = document.createElement("option");
          opt.value = st.station;
          opt.textContent = `${st.station} (Prime: ${st.primeAQH}, ROS: ${st.rosAQH})`;
          stationSelect.appendChild(opt);
        });
      });
    });

    loadRadioData();
  </script>

</body>
</html>
